!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("duna",[],e):"object"==typeof exports?exports.duna=e():t.duna=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,i){"use strict";function n(t,...e){return e.forEach(e=>{for(let i in e||{})e.hasOwnProperty(i)&&s(e[i])&&(e[i].constructor===Object?(t[i]=t[i]||{},n(t[i],e[i])):t[i]=e[i])}),t}function s(t){return void 0!==t&&null!==t}function o(t){return"string"==typeof t}Object.defineProperty(e,"__esModule",{value:!0}),e.merge=n,e.isDefined=s,e.isJsonLike=function(t){let e=t.match(/^\[|^\{(?!\{)/);return!!e&&{"[":/]$/,"{":/}$/}[e[0]].test(t)},e.isFunction=function(t){return"function"==typeof t},e.isString=o,e.isObject=function(t){return null!==t&&"object"==typeof t},e.isNumber=function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},e.template=function(t,e,i="${",n="}"){let o=new RegExp(`\\${i}([^(\\${n})]+)\\${n}`,"g");return t.toString().replace(o,(t,i)=>s(e[i])?e[i]:"")},e.toQuery=function(t,e=(t=>encodeURIComponent(t)),i=(t=>encodeURIComponent(t))){let n=[];for(let s in t)t.hasOwnProperty(s)&&(Array.isArray(t[s])?t[s].forEach(t=>{n.push(`${e(s)}=${i(t)}`)}):n.push(`${e(s)}=${i(t[s])}`));return n.join("&")},e.fromQuery=function(t,e=(t=>decodeURIComponent(t).toLowerCase()),i=(t=>decodeURIComponent(t))){return t?t.split("&").reduce((t,n)=>{let s=n.split("="),o=e(s[0]),r=i(s[1]);return t[o]?(Array.isArray(t[o])||(t[o]=[t[o]]),t[o].push(r)):t[o]=r,t},{}):null},e.titleCase=function(t){return t.replace(/(\w+)/g,t=>t[0].toUpperCase()+t.slice(1).toLowerCase())},e.noDiacritics=function(t){if(!o(t))return t;let e={A:/[\300-\306]/g,a:/[\340-\346]/g,E:/[\310-\313]/g,e:/[\350-\353]/g,I:/[\314-\317]/g,i:/[\354-\357]/g,O:/[\322-\330]/g,o:/[\362-\370]/g,U:/[\331-\334]/g,u:/[\371-\374]/g,N:/[\321]/g,n:/[\361]/g,C:/[\307]/g,c:/[\347]/g};for(let i in e)t=t.replace(e[i],i);return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class ControlBase{constructor(t,e){this.$element=t,this.$options=e,this.$guid=`dn${Math.random().toString(36).substr(2)}`,this._eventsCollection=[],this.$initialize(),this.$invoke(this.$options.onReady,this),this.$registerControl()}dispose(){console.log(`duna: ${this.constructor.name} #${this.$guid} was disposed`),this._eventsCollection.forEach(t=>t.element.removeEventListener(t.type,t.handler,!1)),this._eventsCollection=[];for(let t in this)this[t]=void 0}_ensureUniqueInstancePerType(){let t=this.$element.$duna.findIndex(t=>t.constructor.name===this.constructor.name&&t.constructor.prototype===this.constructor.prototype);if(-1===t)return;let e=this.$element.$duna[t];this.$element.$duna.splice(t,1),e.dispose()}$registerControl(){Array.isArray(this.$element.hasOwnProperty("$duna"))||(this.$element.$duna=[]),this._ensureUniqueInstancePerType(),this.$element.$duna.push(this)}$invoke(t,...e){return"function"==typeof t?t.apply(this,e):void 0}$addEvent(t,e,i){e=e.bind(this),i=i||this.$element,this._eventsCollection.push({type:t,handler:e,element:i}),i.addEventListener(t,e,!1)}$removeEvent(t,e,i){e=e.bind(this),i=i||this.$element;this._eventsCollection.filter(e=>e.element===i&&e.type===t).forEach(i=>{let n=this._eventsCollection.indexOf(i);this._eventsCollection.splice(n,1),i.element.removeEventListener(t,e,!1)})}}e.default=ControlBase},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSize=function(t){let e=/none/i.test(t.style.display||"");e&&(t.style.display=null);let i={width:t.offsetWidth,height:t.offsetHeight};return e&&(t.style.display="none"),i},e.isVisible=function(t){return t.offsetWidth>0&&t.offsetHeight>0},e.addClass=function(t,e){if(!e)return;let i=t.className.split(" ").concat(e.split(" ")).reduce((t,e)=>(-1===t.indexOf(e)&&t.push(e),t),[]);t.className=i.filter(t=>t).join(" ")},e.removeClass=function(t,e){if(!e)return;let i=e.split(" "),n=t.className.split(" ").filter(t=>-1===i.indexOf(t));n.length?t.className=n.filter(t=>t).join(" "):t.removeAttribute("class")},e.setStyle=function(t,e){for(let i in e)t.style[i]=e[i]},e.getStyle=function(t,e){return document.defaultView.getComputedStyle(t).getPropertyValue(e)},e.removeChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}},function(t,e,i){"use strict";function n(t,e,i){return new Promise((n,s)=>{let r=new XMLHttpRequest;i.withCredentials&&(r.withCredentials=i.withCredentials),r.open(t,e,!0,i.user,i.password);let l=i.headers||{};for(var a in l)r.setRequestHeader(a,l[a]);r.onload=(()=>{let t={data:function(t){return t&&o.isFunction(t)?t:(t,e)=>{let i=t.getResponseHeader("Content-Type")||"";return i.indexOf("application/json")>-1||o.isJsonLike(t.responseText)?JSON.parse(t.response):"text/xml"===i.toLowerCase()?t.responseXML:t.responseText}}(i.responseConverter)(r,i),contentType:r.getResponseHeader("Content-Type"),options:i,status:r.status,statusText:r.statusText};r.status>=200&&r.status<300?n(t):s(t)});let h=i.data;o.isObject(h)&&(h=JSON.stringify(h)),r.send(h)})}function s(t,e,i){let s=function(t){const e={Accept:"text/plain, text/javascript, application/json, application/xml, */*","Content-Type":t.json?"application/json; charset=UTF-8":"application/x-www-form-urlencoded; charset=UTF-8"};let i={},n=t.headers||{};for(var s in n)i[o.titleCase(s)]=n[s];return t.crossDomain&&e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),Object.assign({},e,i)}(i);if("get"===t.toLowerCase()&&0===(s["Content-Type"]||"").indexOf("application/json")){let t=e.indexOf("?"),n=o.fromQuery(e.slice(t+1));if(n){let i=o.toQuery(n,encodeURIComponent,JSON.stringify);e=`${e.slice(0,t)}${i}`}i.headers=s}return n(t,e,i)}Object.defineProperty(e,"__esModule",{value:!0});const o=i(0);e.init=s,e.get=function(t,e){return s("get",t,e||{})},e.post=function(t,e,i){return s("post",t,Object.assign({},i,{data:e}))}},function(t,e,i){"use strict";const n=i(5),s=i(0),o=i(2),r=i(3),l=i(6),a=i(7),h=i(8),u=i(9);let c={};Object.defineProperty(c,"ui",{get:()=>({NumericBox:l.default,SearchBox:a.default,Limiter:h.default,MaskEdit:u.default})}),Object.defineProperty(c,"http",{get:()=>r}),Object.defineProperty(c,"dom",{get:()=>o}),Object.defineProperty(c,"utils",{get:()=>s}),Object.defineProperty(c,"version",{get:()=>n.version}),t.exports=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version="1.0.0"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(1);class NumericBox extends s.default{constructor(t,e){super(t,n.merge({scale:0,decimalSeparator:".",groupingSeparator:",",format:["-n","n","n"],placeholder:"n",nullable:!1},e))}$initialize(){this._normalizeFormat(),this._registerEvents(),this.format()}format(){let t=this.getRawValue()||"",e=this.$options,i={value:0,text:""};if(!t&&e.nullable)return void this.$invoke(e.onFormat,this,i);t=t.replace(e.decimalSeparator||"",".");let s=parseFloat(t);n.isNumber(s)||(s=0),s=this._ensureRange(s,e.min,e.max);let o=n.isNumber(e.scale)?e.scale:0,r=s.toFixed(o);if(t=r.replace(".",e.decimalSeparator||""),o>0){let i=new RegExp(`(\\d)(\\d{3}([\\${e.groupingSeparator}\\${e.decimalSeparator}]))`);for(;i.test(t);)t=t.replace(i,`$1${e.groupingSeparator}$2`)}let l="",a=this._dataFormat,h=e.placeholder||"";l=0===s?a[2].replace(h,t):s>0?a[1].replace(h,t):a[0].replace(h,t.replace("-","")),i.value=parseFloat(r),i.text=l,this.$invoke(e.onFormat,this,i),this.$element.value=l}getRawValue(){let t=this.$element.value;if(!t)return"";let e=t.match(/[-\d]+/g);if(!e||!e.length)return"";","!==t[0]&&"."!==t[0]||e.unshift("0");let i=e.length;if(1===i)return parseFloat(e[0]).toString();let n="",s=this.$options.scale>0?".":"";for(;--i>-1;)n=s+e[i]+n,s="";return n?parseFloat(n).toFixed(this.$options.scale):n}_normalizeFormat(){let t=this.$options.format;n.isString(t)?t=["-"+t,t,t]:Array.isArray(t)&&2===t.length&&t.push(t[1]),this._dataFormat=t}_registerEvents(){this.$addEvent("focus",this._onFocusEvent),this.$addEvent("click",this._onFocusEvent),this.$addEvent("keydown",this._onKeyDownEvent),this.$addEvent("change",this._onChangeEvent),this.$addEvent("blur",this.format)}_onKeyDownEvent(t){let e=this.$element;if("Enter"===t.key)return void e.blur();if(t.key.length>1)return;if(/[0-9]/.test(t.key)&&!t.shiftKey)return;if("-"===t.key&&(!e.value||0===e.selectionStart||document.getSelection().toString()===e.value))return;let i=this.$options.scale;/[.,]/.test(t.key)&&n.isNumber(i)&&i>0&&(!/[.,]/g.test(e.value)||document.getSelection().toString()===e.value)||t.preventDefault()}_onFocusEvent(t){let e=this.$element;this.$options.nullable||e.value||this.format(),e.hasAttribute("readonly")||(e.value=this.getRawValue()),e.select(),t.preventDefault()}_onChangeEvent(t){let e=this.$options,i=parseFloat(this.getRawValue()),n=this._ensureRange(i,e.min,e.max);this.$invoke(this.$options.onChange,this,{value:n,inputValue:i})}_ensureRange(t,e,i){let s=n.isNumber(e),o=n.isNumber(i);if(s&&o&&e>=i)throw new RangeError("min must have a lesser value than max");return s&&t<e?e:o&&t>i?i:t}static from(t,e){return[...document.querySelectorAll(t)].map(t=>new NumericBox(t,e))}}e.default=NumericBox},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(2),o=i(3),r=i(1);class SearchBox extends r.default{constructor(t,e){if(!e)throw new Error("SearchBox.options is required.");if(!e.template)throw new Error("SearchBox.options.template is required.");if(!e.source)throw new Error("SearchBox.source is required.");super(t,n.merge({template:"",activeItemClass:"active",delay:500,source:[],matchesTemplate:"<mark>${0}</mark>",fieldTemplate:"${0}",maxResults:10,minLength:2,offsetX:0,offsetY:2,dataRoot:"data",noRecordsTemplate:"<div>No records found</div>",searchFields:[]},e))}$initialize(){this._createTemplate(),this._defineSourceHandler(),this._registerEvents()}_createTemplate(){let t=this.$options.template;this.$element.insertAdjacentHTML("afterend",t);let e=this.$element.nextElementSibling,i=parseInt(s.getStyle(e,"z-index"),10);isNaN(i)&&(i=9999),s.setStyle(e,{display:"none",position:"fixed",margin:0,overflowY:"auto",height:"auto",zIndex:i});let n=e.querySelector("[dn-item]");if(!n)throw new Error("The container template must also have a child element with 'dn-item' attribute on it");this._container=e,this._containerBody=n.parentElement,this._itemTemplate=n.outerHTML}_renderNoRecords(){this._noRecords=!0,this._resetContainerBody(),this.$options.noRecordsTemplate?(this._containerBody.insertAdjacentHTML("beforeend",this.$options.noRecordsTemplate),this._container.style.display="",this._updateContainerStyle()):this._containerBody.style.display="none"}_staticSourceHandler(t){let e=this.$element.value;if(e.length){if(t.length){this._defineDataFilter(t);let i=this._dataFilter({dataSource:t,fields:this._searchFields,search:e.replace(/\\/g,"\\\\")});return i.length?(this._noRecords=!1,void this._render(i,e)):void this._renderNoRecords()}this._renderNoRecords()}}_readData(t){let e=this.$options.dataRoot;return e?(e.split(".").forEach(e=>(t.hasOwnProperty(e)&&(t=t[e]),t)),t):t}_httpSourceHandler(t){let e=this.$element.value.trim();e.length&&(t=t.replace("${query}",encodeURIComponent(e)),this._promiseSourceHandler(()=>o.get(t)))}_promiseSourceHandler(t){window.clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this.$invoke(this.$options.onBeforeRequest,this),t(this.$element.value).then(t=>{let e=this._readData(t);if(!e||!Array.isArray(e))throw new Error("The data source is invalid. Check if the options.dataRoot is correct.");this.$invoke(this.$options.onAfterRequest,this,{container:this._container,data:e}),this._staticSourceHandler(e)},t=>console.error(t))},this.$options.delay)}_normalizeValue(t){return n.isDefined(t)?(n.isString(t)||(t=t.toString().trim()),t):""}_resetContainerBody(){Array.from(this._containerBody.children).forEach(t=>{this.$removeEvent("mouseenter",this._onItemMouseEnterEvent,t),this.$removeEvent("click",this._onItemClick,t)}),s.removeChildren(this._containerBody)}_render(t,e){this._resetContainerBody();let i=this.$options,s=Math.min(t.length,i.maxResults),o=n.noDiacritics(e),r=new RegExp(o,"gi");for(let e=0;e<s;e++){let s=Object.assign({},t[e]),o=this._itemTemplate;this._searchFields.forEach(t=>{let e=this._normalizeValue(s[t]);if(!e)return;let l=e.split("");n.noDiacritics(e).replace(r,(t,n)=>{let s=i.matchesTemplate.replace("${0}",e.substr(n,t.length)),o=n+t.length-1;for(;o>n;)l.splice(o--,1);return l.splice(n,1,s),""}),o=o.replace(new RegExp(`\\\${${t}\\}`,"g"),l.join(""))}),o=n.template(o,s),this._containerBody.insertAdjacentHTML("beforeend",o),this._containerBody.lastElementChild.dunaSearchBoxDataValue=t[e]}this._container.style.display=s?"block":"none",this._updateContainerStyle(),this._registerContainerEvents(),[...this._containerBody.querySelectorAll("img[dn-src]")].forEach(t=>{let e=t.getAttribute("dn-src");e&&e.length>0&&(t.src=e)}),this.$invoke(this.$options.onResultsRender,this,{container:this._container})}_defineDataFilter(t){if(!this._dataFilter)if(n.isString(t[0]))this._dataFilter=this._stringDataFilter,this._searchFields=["0"];else{this._dataFilter=this._objectDataFilter;let e=this.$options.searchFields;Array.isArray(e)&&e.length||(e=Object.keys(t[0])),this._searchFields=e}}_stringDataFilter(t){return this._objectDataFilter(Object.assign(t,{dataSource:t.dataSource.map(t=>({0:t}))}))}_objectDataFilter(t){let e=n.noDiacritics(t.search),i=new RegExp(e,"i"),s=t.fields,o=s.length;return t.dataSource.reduce((t,e)=>{for(let r=0;r<o;r++){let o=n.noDiacritics(e[s[r]]);if(i.test(o)){t.push(e);break}}return t},[])}_defineSourceHandler(){Array.isArray(this.$options.source)?(this._sourceHandler=this._staticSourceHandler,this._sourceData=this.$options.source):n.isString(this.$options.source)?this._sourceHandler=this._httpSourceHandler:this._sourceHandler=this._promiseSourceHandler}_selectItem(t){this._resetContainerBody();let e=t.dunaSearchBoxDataValue,i=n.template(this.$options.fieldTemplate,e);this.$element.value=i,this.$invoke(this.$options.onItemSelected,this,{data:e,text:t.innerText.trim()}),this.$element.dispatchEvent(new Event("input",{bubbles:!0})),this._container.style.display="none"}_registerEvents(){this.$addEvent("keydown",this._onKeyDownEvent),this.$addEvent("input",this._onInputEvent),this.$addEvent("blur",this._onBlurEvent),this.$addEvent("scroll",this._onWindowScrollOrResize,window),this.$addEvent("resize",this._onWindowScrollOrResize,window)}_keyboardNavigate(t){let e="ArrowDown"===t.key;if(!e&&"ArrowUp"!==t.key)return;let i=this.$options.activeItemClass,n=this._containerBody.querySelector("."+i),o=e?["firstElementChild","nextElementSibling"]:["lastElementChild","previousElementSibling"];n&&(s.removeClass(n,i),n=n[o[1]]),n||(n=this._containerBody[o[0]]),s.addClass(n,i);let r=n.dunaSearchBoxDataValue;this.$invoke(this.$options.onActiveItem,this,{data:r,text:n.innerText.trim()}),this._updateContainerScrollPosition(n,e)}_updateContainerScrollPosition(t,e){let i=this._containerBody,n=t===i.firstElementChild?0:t===i.lastElementChild?i.scrollHeight:-1;if(n>-1)return void(i.scrollTop=n);let s=i.offsetHeight,o=t.offsetTop+(e?t.offsetHeight:0);if(o>s+i.scrollTop)return void(i.scrollTop=o+(e?.2*t.offsetHeight:t.offsetHeight)-s);o-i.scrollTop<0&&(i.scrollTop=o-(e?t.offsetHeight:.2*t.offsetHeight))}_onWindowScrollOrResize(){s.isVisible(this._container)&&this._updateContainerStyle()}_onKeyDownEvent(t){if(s.isVisible(this._container)&&!this._noRecords){if("Enter"===t.key||"Tab"===t.key){let e=this.$options.activeItemClass,i=this._containerBody.querySelector("."+e);if(!i){if(1!==this._containerBody.children.length)return;i=this._containerBody.firstElementChild}return i&&this._selectItem(i),void("Enter"===t.key&&t.preventDefault())}this._keyboardNavigate(t)}}_onInputEvent(t){let e=this.$element.value;t.isTrusted&&(e.length&&e.length<this.$options.minLength||(this._sourceHandler(this.$options.source),e.length||(this._container.style.display="none")))}_onBlurEvent(){this._container.matches(":hover")||(this._container.style.display="none")}_updateContainerStyle(){let t=this.$element.getBoundingClientRect();this._container.style.minWidth=t.width+"px",this._container.style.height="auto";let e=this.$options.offsetY,i=this.$options.offsetX,n=this._container.offsetHeight+e,s=window.innerHeight-t.bottom,o=Math.max(t.top,s),r=Math.min(n,o);r<n&&(this._container.style.height=r+"px");let l=t.left+i,a=s>=t.top?t.bottom+e:t.top-this._container.offsetHeight-e;this._container.style.top=a+"px",this._container.style.left=l+"px"}_registerContainerEvents(){Array.from(this._containerBody.children).forEach(t=>{this.$addEvent("mouseenter",this._onItemMouseEnterEvent,t),this.$addEvent("click",this._onItemClick,t)})}_onItemMouseEnterEvent(t){let e=this.$options.activeItemClass,i=t.target.parentElement.querySelector("."+e);i&&s.removeClass(i,e),s.addClass(t.target,e)}_onItemClick(t){this._selectItem(t.currentTarget)}static from(t,e){return[...document.querySelectorAll(t)].map(t=>new SearchBox(t,e))}}e.default=SearchBox},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(2),o=i(1);class Limiter extends o.default{constructor(t,e){super(t,n.merge({position:"right bottom",template:"<small><em>${len} / ${max}</em></small>",timeout:1.5,offsetX:0,offsetY:0,preserve:!1,showOnFocus:!1},e))}$initialize(){this._registerEvents(),this._configPosition(),this._timer=null}dispose(){this._tooltip&&this._destroy(),window.removeEventListener("scroll",this._onWindowScrollOrResize,!1),super.dispose()}_destroy(){this._tooltip&&this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null}_getTooltip(t){let e=this._tooltip&&s.isVisible(this._tooltip);if(!this._tooltip){this.$element.insertAdjacentHTML("afterend",this.$options.template),this._tooltip=this.$element.nextElementSibling,this._templateContent=this._tooltip.innerHTML,this._tooltip.style.position="fixed";let t=this.$element.getBoundingClientRect();this._tooltip.style.left=t.left+"px",this.$invoke(this.$options.onCreate,this,{tooltip:this._tooltip}),this._tooltip.style.display="none"}if(!e){if(t&&!this.$options.showOnFocus)return this._tooltip;this.$invoke(this.$options.onShow,this,{tooltip:this._tooltip}),this._tooltip.style.display=""}return this._tooltip}_registerEvents(){this.$addEvent("focus",this._onFocusEvent),this.$addEvent("input",this._onInputEvent),this.$addEvent("blur",this._onBlurEvent),this.$addEvent("scroll",this._onWindowScrollOrResize,window),this.$addEvent("resize",this._onWindowScrollOrResize,window)}_onWindowScrollOrResize(){this._tooltip&&s.isVisible(this._tooltip)&&this._updatePosition()}_onFocusEvent(t){this.$options.showOnFocus&&this._onInputEvent()}_onInputEvent(){let t=this._getTooltip(!0),e={len:this.$element.value.length,max:this.$element.maxLength,rem:0};e.rem=e.max-e.len,t.innerHTML=n.template(this._templateContent,e),this._updatePosition(),window.clearTimeout(this._timer||0),this._timer=window.setTimeout(()=>this._onBlurEvent(),1e3*this.$options.timeout)}_onBlurEvent(){this._tooltip&&"none"!==this._tooltip.style.display&&(this.$options.preserve?this._tooltip.style.display="none":this._destroy.call(this),this.$invoke(this.$options.onHide,this,{tooltip:this._tooltip}))}_updatePosition(){let t=this._getTooltip(),e=this.$element.getBoundingClientRect(),i=(this.$options.position,s.getSize(t)),n=this._position.x(e,i),o=this._position.y(e,i);n+=this.$options.offsetX,o+=this.$options.offsetY,t.style.left=`${n}px`,t.style.top=`${o}px`,this.$invoke(this.$options.onChange,this,{tooltip:this._tooltip})}_configPosition(){let t={left:(t,e)=>t.left,right:(t,e)=>t.right-e.width,top:(t,e)=>t.top-e.height,bottom:(t,e)=>t.bottom},e=this.$options.position;this._position={};let i=e.match(/(^| )(left|right)( |$)/);i&&(this._position.x=t[i[2]]),(i=e.match(/(^| )(top|bottom)( |$)/))&&(this._position.y=t[i[2]])}static from(t,e){return[...document.querySelectorAll(t)].map(t=>new Limiter(t,e))}}e.default=Limiter},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(1);class MaskEdit extends s.default{constructor(t,e){super(t,n.merge({format:"",placeholder:"",allowPartial:!1,shifter:"_",translation:{9:{test:/[0-9]/},a:{test:/[A-Za-z]/},A:{test:/[A-Za-z]/,transform:t=>t.toUpperCase()}}},e))}update(){let t=this.$element.value,e=[];for(let i=0,n=0;i<this._currentFormat.length;i++){let s=this._applyMask(i,n,t);if(void 0!==s.arg&&e.push(s.value),s.ok)n++;else if(!s.keepRunning||void 0===t[n])break}this._setValue(e.join(""))}getRawValue(){let t=[],e=this.$element.value;for(let i=0;i<e.length;i++)this._hasTranslation(i)&&e[i]!==this.$options.shifter&&t.push(e[i]);return t.join("")}setOptions(t){this._setOptionsInternal(t),this._onBlurEvent()}dispose(){-1===this._originalMaxLength?this.$element.removeAttribute("maxlength"):this.$element.maxLength=this._originalMaxLength,super.dispose()}$initialize(){this._setOptionsInternal(null),this._defineFormat(!0),this._registerEvents(),this.update()}_setOptionsInternal(t){n.merge(this.$options,t),this._configOptions(),this._defineFormat(!0),this._normalizeTranslations(),this.$element.value=this.getRawValue(),this.update()}_applyMask(t,e,i){let n=i[e],s=this._currentFormat[t],o=this._translations[s],r={isMask:!o&&void 0!==s,arg:n,ok:!!o&&o.test(n||"")||s===n,keepRunning:!o&&t<this._currentFormat.length,value:""};return r.ok?r.value=(o&&o.transform?o.transform:t=>t)(n||""):r.value=o?"":s,r}_replace(t){t.preventDefault();let e=this.$element.selectionStart,i=this.$element.value.split("");i[e]=t.key;let n=i.join("");for(let t=e;t<this._currentFormat.length;t++){let s=this._applyMask(t,e,n);if(s.ok){i[t]=s.value,e=t;break}if(!s.isMask){i[t]=this.$element.value[t];break}if(i[t]=s.value,!s.keepRunning||void 0===i[t])break}this._setValue(i.join("")),this._setCaretPosition(e+1)}_hasTranslation(t){let e=this._currentFormat[t];return!!this._translations[e]}_defineFormat(t){t&&(this._currentFormat=this._formats[0]),this._originalMaxLength||(this._originalMaxLength=this.$element.maxLength),this.$element.maxLength=this._currentFormat.length}_configOptions(){this._formats=n.isString(this.$options.format)?[this.$options.format]:[].concat(this.$options.format),this.$element.placeholder=this.$options.placeholder||this._formats[0]}_normalizeTranslations(){this._translations={};let t=this.$options.translation||{};for(let e in t){let i=t[e].test;this._translations[e]={test:i instanceof RegExp?t=>i.test(t):i,transform:t[e].transform}}}_registerEvents(){this.$addEvent("input",this._onInputEvent),this.$addEvent("keydown",this._onKeyDownEvent),this.$addEvent("blur",this._onBlurEvent)}_onBlurEvent(){let t=this.$element.value;t.indexOf(this.$options.shifter)>=0?this._setValue(""):t.length!==this._currentFormat.length&&(this.$options.allowPartial||this._setValue(""))}_onInputEvent(){this.update()}_onKeyDownEvent(t){let e=this._getCaretPosition();1!==t.key.length?"Backspace"!==t.key?"Delete"!==t.key||this._deleteHandler.call(this,t,e):this._backspaceHandler.call(this,t,e):this.$element.value[e.start]&&this._replace(t)}_getMaskWithShifter(){if(this._maskWithShifter)return this._maskWithShifter;let t=this._currentFormat.split("");for(let e=0;e<t.length;e++)this._hasTranslation(e)&&(t[e]=this.$options.shifter);return this._maskWithShifter=t.join("")}_default(t){return!this.$element.value.length||!t.areEquals&&0===t.start&&t.end===this.$element.value.length}_deleteHandler(t,e){if(this._default(e))return;t.preventDefault();do{e.end++}while(!this._hasTranslation(e.end-1)&&e.end<this._currentFormat.length);let i=this.$element.value.split(""),n=this._getMaskWithShifter().substring(e.start,e.end);i.splice.apply(i,[e.start,e.end-e.start].concat(n.split(""))),this._setValue(i.join("")),this._setCaretPosition(e.start,e.end)}_backspaceHandler(t,e){if(this._default(e))return;if(t.preventDefault(),e.areEquals)do{e.start=Math.max(e.start-1,0)}while(!this._hasTranslation(e.start)&&e.start>0);let i=this.$element.value.split("");if(e.end===this.$element.value.length)i.splice(e.start);else{let t=this._getMaskWithShifter().substring(e.start,e.end);i.splice.apply(i,[e.start,e.end-e.start].concat(t.split("")))}this._setValue(i.join("")),this._setCaretPosition(e.start)}_setCaretPosition(t,e){this.$element.selectionStart=t,this.$element.selectionEnd=e||t}_getCaretPosition(){let t=this.$element.selectionStart,e=this.$element.selectionEnd;return{start:t,end:e,areEquals:t===e}}_setValue(t){this.$element.value=t,this.$invoke(this.$options.onUpdate,this,{value:t,rawValue:this.getRawValue()})}static from(t,e){return[...document.querySelectorAll(t)].map(t=>new MaskEdit(t,e))}}e.default=MaskEdit}])});
//# sourceMappingURL=duna.js.map